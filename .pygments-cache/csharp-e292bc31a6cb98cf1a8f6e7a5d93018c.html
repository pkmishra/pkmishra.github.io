<div class="highlight"><pre><span class="k">public</span> <span class="n">DataTable</span> <span class="nf">GetSomeData</span><span class="p">(</span><span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="err">…</span><span class="p">.,</span> <span class="kt">string</span> <span class="n">sortExpression</span><span class="p">)</span>
<span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="c1">//Linq query goes here )</span>
<span class="c1">// We want something like this which is not possible as of now</span>
<span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="n">some</span> <span class="n">query</span><span class="p">)</span> <span class="p">(</span><span class="n">OrderBy</span> <span class="n">SortExpression</span><span class="p">)</span>
<span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
<span class="n">Here</span> <span class="k">is</span> <span class="n">the</span> <span class="n">extension</span> <span class="n">method</span> <span class="n">you</span> <span class="n">would</span> <span class="n">like</span> <span class="n">to</span> <span class="n">follow</span><span class="err">…</span><span class="p">&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">public</span> <span class="n">DataTable</span> <span class="n">GetSomeData</span><span class="p">(</span><span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="err">…</span><span class="p">.,</span> <span class="kt">string</span> <span class="n">sortExpression</span><span class="p">)</span>
<span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="c1">//Linq query goes here )</span>
<span class="c1">// We want something like this which is not possible as of now</span>
<span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="n">some</span> <span class="n">query</span><span class="p">)</span> <span class="p">(</span><span class="n">OrderBy</span> <span class="n">SortExpression</span><span class="p">)</span>
<span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">Util</span>
<span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="c1">//Thanks to Ernesto for pointing out a small correction in method signature.</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">IQueryable</span> <span class="nf">OrderBy</span><span class="p">(</span><span class="k">this</span> <span class="n">IQueryable</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sortExpression</span><span class="p">)</span> <span class="k">where</span> <span class="n">TEntity</span> <span class="p">:</span> <span class="k">class</span>
<span class="err">{</span>
<span class="kt">var</span> <span class="n">type</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TEntity</span><span class="p">);</span>
<span class="c1">// Remember that for ascending order GridView just returns the column name and for descending it returns column name followed by DESC keyword</span>
<span class="c1">// Therefore we need to examine the sortExpression and separate out Column Name and order (ASC/DESC)</span>
<span class="kt">string</span><span class="p">[]</span> <span class="n">expressionParts</span> <span class="p">=</span> <span class="n">sortExpression</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="err">‘</span> <span class="err">‘</span><span class="p">);</span> <span class="c1">// Assuming sortExpression is like [ColoumnName DESC] or [ColumnName]</span>
<span class="kt">string</span> <span class="n">orderByProperty</span> <span class="p">=</span> <span class="n">expressionParts</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="kt">string</span> <span class="n">sortDirection</span> <span class="p">=</span> <span class="err">“</span><span class="n">ASC</span><span class="err">”</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">methodName</span> <span class="p">=</span> <span class="err">“</span><span class="n">OrderBy</span><span class="err">”</span><span class="p">;</span>

<span class="c1">//if sortDirection is descending</span>
<span class="k">if</span> <span class="p">(</span><span class="n">expressionParts</span><span class="p">.</span><span class="n">Length</span> <span class="p">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="m">1</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">expressionParts</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="err">“</span><span class="n">DESC</span><span class="err">”</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">sortDirection</span> <span class="p">=</span> <span class="err">“</span><span class="n">Descending</span><span class="err">”</span><span class="p">;</span>
    <span class="n">methodName</span> <span class="p">+=</span> <span class="n">sortDirection</span><span class="p">;</span> <span class="c1">// Add sort direction at the end of Method name</span>
<span class="p">}</span>
<span class="kt">var</span> <span class="n">property</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">orderByProperty</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">parameter</span> <span class="p">=</span> <span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="err">“</span><span class="n">p</span><span class="err">”</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">propertyAccess</span> <span class="p">=</span> <span class="n">Expression</span><span class="p">.</span><span class="n">MakeMemberAccess</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">property</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">orderByExp</span> <span class="p">=</span> <span class="n">Expression</span><span class="p">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">propertyAccess</span><span class="p">,</span> <span class="n">parameter</span><span class="p">);</span>
<span class="n">MethodCallExpression</span> <span class="n">resultExp</span> <span class="p">=</span> <span class="n">Expression</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Queryable</span><span class="p">),</span> <span class="n">methodName</span><span class="p">,</span>
<span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="n">type</span><span class="p">,</span> <span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span> <span class="p">},</span>
<span class="n">source</span><span class="p">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">Expression</span><span class="p">.</span><span class="n">Quote</span><span class="p">(</span><span class="n">orderByExp</span><span class="p">));</span>
<span class="k">return</span> <span class="n">source</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">CreateQuery</span><span class="p">(</span><span class="n">resultExp</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
<span class="p">}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="c1">//Usage will be as of follows…&lt;/p&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">public</span> <span class="n">DataTable</span> <span class="n">GetSomeData</span><span class="p">(</span><span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="err">…</span><span class="p">.,</span> <span class="kt">string</span> <span class="n">sortExpression</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="c1">//Linq query goes here )</span>
<span class="c1">// We want something like this which is not possible as of now</span>
<span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="p">(</span><span class="n">some</span> <span class="n">query</span><span class="p">)</span>
<span class="k">return</span> <span class="n">query</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">SortExpression</span><span class="p">).</span><span class="n">ToDataTable</span><span class="p">(</span><span class="n">rec</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">query</span><span class="p">}));</span>
<span class="p">}</span>
</pre></div>